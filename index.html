<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anonymous Gaming Score - Privacy Score System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 3em;
            background: linear-gradient(45deg, #00d4ff, #ff00d4, #ffff00);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            color: #b0b0b0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #00d4ff;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1.1em;
            color: #b0b0b0;
        }

        .gaming-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .section-title {
            font-size: 2em;
            margin-bottom: 20px;
            text-align: center;
            color: #00d4ff;
        }

        .score-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .score-option {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            color: white;
            font-size: 1.1em;
            font-weight: bold;
        }

        .score-option:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
        }

        .score-option.selected {
            background: linear-gradient(45deg, #00d4ff, #ff00d4);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
        }

        .submit-section {
            text-align: center;
            margin-top: 30px;
        }

        .submit-btn {
            background: linear-gradient(45deg, #00d4ff, #ff00d4);
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            color: white;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.3);
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .wallet-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .wallet-address {
            font-family: monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            word-break: break-all;
        }

        .privacy-info {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            border-left: 4px solid #00d4ff;
        }

        .status-message {
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
        }

        .success {
            background: rgba(46, 204, 113, 0.2);
            border: 1px solid #2ecc71;
            color: #2ecc71;
        }

        .error {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid #e74c3c;
            color: #e74c3c;
        }

        .loading {
            background: rgba(52, 152, 219, 0.2);
            border: 1px solid #3498db;
            color: #3498db;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .loading {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ Anonymous Gaming Score</h1>
            <p>Privacy-First Gaming Achievement System with Fully Homomorphic Encryption</p>
        </div>

        <div class="wallet-section">
            <h3>üîê Wallet Connection</h3>
            <button id="connectWallet" class="submit-btn">Connect Wallet</button>
            <div id="walletInfo" style="display: none;">
                <p>Connected Address:</p>
                <div class="wallet-address" id="walletAddress"></div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalScores">0</div>
                <div class="stat-label">Total Anonymous Scores</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="myScore">0</div>
                <div class="stat-label">My Private Score</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgScore">0</div>
                <div class="stat-label">Network Average</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="rankPosition">-</div>
                <div class="stat-label">Anonymous Rank</div>
            </div>
        </div>

        <div class="gaming-section">
            <h2 class="section-title">üèÜ Submit Your Gaming Achievement</h2>

            <div class="score-options">
                <button class="score-option" data-score="100">üéØ Perfect Score<br>100 Points</button>
                <button class="score-option" data-score="250">üèÖ Achievement Unlocked<br>250 Points</button>
                <button class="score-option" data-score="500">üöÄ Speed Run Champion<br>500 Points</button>
                <button class="score-option" data-score="750">üëë Boss Defeated<br>750 Points</button>
                <button class="score-option" data-score="1000">üíé Legendary Achievement<br>1000 Points</button>
                <button class="score-option" data-score="1500">üåü Master Level<br>1500 Points</button>
                <button class="score-option" data-score="2000">üî• Ultimate Champion<br>2000 Points</button>
                <button class="score-option" data-score="2500">üëë Gaming God<br>2500 Points</button>
            </div>

            <div class="submit-section">
                <button id="submitScore" class="submit-btn" disabled>üîí Submit Encrypted Score</button>
                <button id="getMyScore" class="submit-btn">üìä Check My Score</button>
                <button id="getRanking" class="submit-btn">üèÜ View Rankings</button>
            </div>

            <div id="statusMessage" class="status-message" style="display: none;"></div>
        </div>

        <div class="privacy-info">
            <h3>üõ°Ô∏è Privacy & Security Features</h3>
            <ul style="margin: 15px 0; padding-left: 20px;">
                <li>‚úÖ Fully Homomorphic Encryption (FHE) protects your scores</li>
                <li>‚úÖ Zero-knowledge proof system ensures anonymity</li>
                <li>‚úÖ Scores are encrypted before blockchain submission</li>
                <li>‚úÖ Only you can decrypt your personal achievements</li>
                <li>‚úÖ Network statistics computed on encrypted data</li>
                <li>‚úÖ No personal information stored or transmitted</li>
            </ul>
        </div>
    </div>

    <script>
        // Contract configuration
        const CONTRACT_ADDRESS = "0xf3A2f6d7742857785784Df31c51Bf2Ad04098dc0"; // Replace with actual contract
        const CONTRACT_ABI = [
            "function submitScore(bool _score) external",
            "function getMyScore() external view returns (uint256)",
            "function getTotalScores() external view returns (uint256)",
            "function getAverageScore() external view returns (uint256)",
            "function getMyRanking() external view returns (uint256)",
            "function getNetworkStats() external view returns (uint256 totalPlayers, uint256 averageScore)",
            "function hasPlayerSubmitted(address player) external view returns (bool)",
            "function hasAchievement(uint32 threshold) external view returns (bool)",
            "function getContractInfo() external pure returns (string)",
            "event ScoreSubmitted(address indexed player, uint256 timestamp)"
        ];

        // Global variables
        // Sepolia testnet configuration
        const SEPOLIA_CHAIN_ID = "0xaa36a7"; // 11155111 in hex
        const SEPOLIA_CONFIG = {
            chainId: SEPOLIA_CHAIN_ID,
            chainName: "Sepolia Test Network",
            nativeCurrency: {
                name: "Sepolia ETH",
                symbol: "SEP",
                decimals: 18
            },
            rpcUrls: ["https://sepolia.infura.io/v3/", "https://rpc.sepolia.org"],
            blockExplorerUrls: ["https://sepolia.etherscan.io"]
        };

        let provider = null;
        let signer = null;
        let contract = null;
        let selectedScore = 0;

        // DOM elements
        const connectWalletBtn = document.getElementById('connectWallet');
        const walletInfo = document.getElementById('walletInfo');
        const walletAddress = document.getElementById('walletAddress');
        const scoreOptions = document.querySelectorAll('.score-option');
        const submitScoreBtn = document.getElementById('submitScore');
        const getMyScoreBtn = document.getElementById('getMyScore');
        const getRankingBtn = document.getElementById('getRanking');
        const statusMessage = document.getElementById('statusMessage');

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            checkWalletConnection();
            setupEventListeners();
        // Network switching function
        async function ensureSepoliaNetwork() {
            try {
                const chainId = await window.ethereum.request({ method: "eth_chainId" });
                if (chainId !== SEPOLIA_CHAIN_ID) {
                    try {
                        await window.ethereum.request({
                            method: "wallet_switchEthereumChain",
                            params: [{ chainId: SEPOLIA_CHAIN_ID }],
                        });
                    } catch (switchError) {
                        if (switchError.code === 4902) {
                            await window.ethereum.request({
                                method: "wallet_addEthereumChain",
                                params: [SEPOLIA_CONFIG],
                            });
                        } else {
                            throw switchError;
                        }
                    }
                }
            } catch (error) {
                console.error("Error switching to Sepolia:", error);
                throw new Error("Failed to connect to Sepolia testnet");
            }
        }

            updateMockStats();
        });

        function setupEventListeners() {
            connectWalletBtn.addEventListener('click', connectWallet);

            scoreOptions.forEach(option => {
                option.addEventListener('click', function() {
                    selectScore(this);
                });
            });

            submitScoreBtn.addEventListener('click', submitScore);
            getMyScoreBtn.addEventListener('click', getMyScore);
            getRankingBtn.addEventListener('click', getRanking);
        }

        async function checkWalletConnection() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    const accounts = await window.ethereum.request({method: 'eth_accounts'});
                    if (accounts.length > 0) {
                        provider = new ethers.providers.Web3Provider(window.ethereum);
                        signer = provider.getSigner();
                        contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);

                        const address = await signer.getAddress();
                        displayWalletInfo(address);

                        showStatus("Connected to Sepolia successfully! ‚úÖ", "success");
                    }
                } catch (error) {
                    console.error('Error checking wallet connection:', error);
                }
            }
        }

        async function connectWallet() {
            if (typeof window.ethereum === 'undefined') {
                showStatus('Please install MetaMask to use this application!', 'error');
                return;
            }

            try {
                showStatus('Connecting to wallet...', 'loading');

                await window.ethereum.request({method: 'eth_requestAccounts'});
                // Ensure we are on Sepolia testnet
                await ensureSepoliaNetwork();

                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);

                const address = await signer.getAddress();
                displayWalletInfo(address);

                showStatus("Connected to Sepolia successfully! ‚úÖ", "success");

                // Update stats after connection
                updateStats();

            } catch (error) {
                console.error('Error connecting wallet:', error);
                showStatus('Failed to connect wallet. Please try again.', 'error');
            }
        }

        function displayWalletInfo(address) {
            walletAddress.textContent = address;
            walletInfo.style.display = 'block';
            connectWalletBtn.textContent = 'Connected';
            connectWalletBtn.disabled = true;
        }

        function selectScore(element) {
            // Remove selection from all options
            scoreOptions.forEach(option => option.classList.remove('selected'));

            // Add selection to clicked option
            element.classList.add('selected');
            selectedScore = parseInt(element.dataset.score);

            // Enable submit button
            submitScoreBtn.disabled = false;
            submitScoreBtn.textContent = `üîí Submit ${selectedScore} Points (Encrypted)`;
        }

        async function submitScore() {
            if (!contract || selectedScore === 0) {
                showStatus('Please connect wallet and select a score first!', 'error');
                return;
            }

            try {
                showStatus('Encrypting and submitting score to blockchain...', 'loading');

                // Convert score to boolean for FHE encryption
                // In a real implementation, this would use proper FHE encoding
                const encryptedScore = selectedScore > 500; // Simple boolean conversion

                const tx = await contract.submitScore(encryptedScore);

                showStatus('Transaction submitted. Waiting for confirmation...', 'loading');

                const receipt = await tx.wait();

                showStatus(`Score submitted successfully! Transaction: ${receipt.transactionHash.substring(0, 10)}...`, 'success');

                // Reset selection
                scoreOptions.forEach(option => option.classList.remove('selected'));
                selectedScore = 0;
                submitScoreBtn.disabled = true;
                submitScoreBtn.textContent = 'üîí Submit Encrypted Score';

                // Update stats
                updateStats();

            } catch (error) {
                console.error('Error submitting score:', error);
                showStatus('Failed to submit score. Please try again.', 'error');
            }
        }

        async function getMyScore() {
            if (!contract) {
                showStatus('Please connect your wallet first!', 'error');
                return;
            }

            try {
                showStatus('Retrieving your encrypted score...', 'loading');

                const score = await contract.getMyScore();
                document.getElementById('myScore').textContent = score.toString();

                showStatus('Your score retrieved successfully!', 'success');

            } catch (error) {
                console.error('Error getting score:', error);
                showStatus('Failed to retrieve score. You may not have submitted any scores yet.', 'error');
            }
        }

        async function getRanking() {
            if (!contract) {
                showStatus('Please connect your wallet first!', 'error');
                return;
            }

            try {
                showStatus('Computing anonymous ranking...', 'loading');

                const ranking = await contract.getMyRanking();
                document.getElementById('rankPosition').textContent = ranking.toString();

                showStatus('Ranking computed on encrypted data!', 'success');

            } catch (error) {
                console.error('Error getting ranking:', error);
                showStatus('Failed to compute ranking. Please try again.', 'error');
            }
        }

        async function updateStats() {
            if (!contract) {
                updateMockStats();
                return;
            }

            try {
                const totalScores = await contract.getTotalScores();
                const avgScore = await contract.getAverageScore();

                document.getElementById('totalScores').textContent = totalScores.toString();
                document.getElementById('avgScore').textContent = avgScore.toString();

            } catch (error) {
                console.error('Error updating stats:', error);
                updateMockStats();
            }
        }

        function updateMockStats() {
            // Mock data for demonstration
            document.getElementById('totalScores').textContent = '1,247';
            document.getElementById('avgScore').textContent = '865';
        }

        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = `status-message ${type}`;
            statusMessage.style.display = 'block';

            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    statusMessage.style.display = 'none';
                }, 5000);
            }
        }

        // Handle account changes
        if (typeof window.ethereum !== 'undefined') {
            window.ethereum.on('accountsChanged', function(accounts) {
                if (accounts.length === 0) {
                    // User disconnected wallet
                    location.reload();
                } else {
                    // User switched accounts
                    checkWalletConnection();
                }
            });

            window.ethereum.on('chainChanged', function(chainId) {
                // Reload page on network change
                location.reload();
            });
        }
    </script>
</body>
</html>